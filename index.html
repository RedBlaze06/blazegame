<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FusÃ©e Infinity</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:black;color:white;font-family:Arial;overflow:hidden}
.screen{position:absolute;inset:0;display:none}
.active{display:flex}

/* ACCUEIL */
#home-screen,#leaderboard-screen{
    background:url("rocket-bg.jpg") center/cover;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:20px;
}
#title{font-size:42px;text-shadow:0 0 10px white}
input,button{
    padding:12px 20px;
    font-size:18px;
    border-radius:10px;
    border:none;
}
button{background:#2196f3;color:white;cursor:pointer}

/* MEILLEUR SCORE */
#best{
    position:absolute;
    bottom:20px;
    left:20px;
    font-size:18px;
}

/* CLASSEMENT */
#leaderboard-list{
    width:300px;
}
.item{
    display:flex;
    justify-content:space-between;
    background:rgba(0,0,0,.6);
    padding:8px;
    margin:6px 0;
    border-radius:8px;
}

/* JEU */
#game-screen{background:black;overflow:hidden}
.star{
    position:absolute;
    width:2px;height:2px;
    background:white;
    opacity:.8;
}
.rocket{
    position:absolute;
    bottom:40px;
    width:40px;height:80px;
    background:red;
    left:50%;
    transform:translateX(-50%);
    z-index:2;
}
.rock{
    position:absolute;
    width:50px;height:50px;
    background:gray;
    border-radius:50%;
    z-index:2;
}
#score{position:absolute;top:10px;left:10px;font-size:22px;z-index:3}
</style>
</head>

<body>

<!-- ACCUEIL -->
<div id="home-screen" class="screen active">
    <div id="title">FUSÃ‰E INFINITY</div>
    <input id="pseudo" placeholder="Ton pseudo">
    <button onclick="play()">Jouer</button>
    <button onclick="showLeaderboard()">Classement</button>
    <div id="best">Meilleur score : 0</div>
</div>

<!-- CLASSEMENT -->
<div id="leaderboard-screen" class="screen">
    <div id="leaderboard-list"></div>
</div>

<!-- JEU -->
<div id="game-screen" class="screen">
    <div id="score">Score : 0</div>
    <div class="rocket" id="rocket"></div>
</div>

<script>
const home=document.getElementById("home-screen")
const game=document.getElementById("game-screen")
const leader=document.getElementById("leaderboard-screen")
const rocket=document.getElementById("rocket")
const scoreTxt=document.getElementById("score")
const list=document.getElementById("leaderboard-list")
const pseudoInput=document.getElementById("pseudo")
const bestTxt=document.getElementById("best")

let x=window.innerWidth/2
let score=0
let speed=4
let spawnDelay=800
let gameOver=false
let player=""

function switchScreen(s){
    [home,game,leader].forEach(e=>e.classList.remove("active"))
    s.classList.add("active")
}

function updateBest(){
    bestTxt.textContent="Meilleur score : "+(localStorage.getItem("bestScore")||0)
}
updateBest()

/* â­ Ã‰TOILES */
function spawnStars(){
    document.querySelectorAll(".star").forEach(s=>s.remove())
    for(let i=0;i<120;i++){
        let s=document.createElement("div")
        s.className="star"
        s.style.left=Math.random()*innerWidth+"px"
        s.style.top=Math.random()*innerHeight+"px"
        game.appendChild(s)

        setInterval(()=>{
            if(!game.classList.contains("active"))return
            let t=parseInt(s.style.top)
            s.style.top=(t+2)%innerHeight+"px"
        },60)
    }
}

function play(){
    player=pseudoInput.value||"Anonyme"
    score=0
    speed=4
    spawnDelay=800
    gameOver=false
    scoreTxt.textContent="Score : 0"
    document.querySelectorAll(".rock").forEach(r=>r.remove())
    spawnStars()
    switchScreen(game)
    loopScore()
    spawnRock()
}

function showLeaderboard(){
    list.innerHTML=""
    let data=JSON.parse(localStorage.getItem("leaderboard")||"[]")

    data.forEach((e,i)=>{
        let medal=i==0?"ðŸ¥‡":i==1?"ðŸ¥ˆ":i==2?"ðŸ¥‰":(i+1)+"."
        let d=document.createElement("div")
        d.className="item"
        d.innerHTML=`<span>${medal} ${e.name}</span><span>${e.score}</span>`
        list.appendChild(d)
    })
    switchScreen(leader)
}

leader.onclick=()=>switchScreen(home)

/* CONTROLES */
document.addEventListener("keydown",e=>{
    if(!game.classList.contains("active"))return
    if(e.key==="ArrowLeft")x-=30
    if(e.key==="ArrowRight")x+=30
    x=Math.max(0,Math.min(innerWidth-40,x))
    rocket.style.left=x+"px"
})

/* SCORE + DIFFICULTÃ‰ EXPONENTIELLE APRÃˆS 500 */
function loopScore(){
    let i=setInterval(()=>{
        if(gameOver) return clearInterval(i)
        score++
        scoreTxt.textContent="Score : "+score

        if(score>=500){
            speed*=1.01
            spawnDelay=Math.max(200,spawnDelay*0.99)
        }
    },200)
}

/* ROCHERS */
function spawnRock(){
    if(gameOver)return
    let r=document.createElement("div")
    r.className="rock"
    r.style.left=Math.random()*(innerWidth-50)+"px"
    r.style.top="-60px"
    game.appendChild(r)

    let fall=setInterval(()=>{
        let t=parseInt(r.style.top)
        r.style.top=t+speed+"px"
        let a=r.getBoundingClientRect()
        let b=rocket.getBoundingClientRect()

        if(a.bottom>b.top && a.top<b.bottom && a.left<b.right && a.right>b.left){
            end()
            clearInterval(fall)
        }
        if(t>innerHeight){
            r.remove()
            clearInterval(fall)
        }
    },20)

    setTimeout(spawnRock,spawnDelay)
}

function end(){
    gameOver=true

    let best=localStorage.getItem("bestScore")||0
    if(score>best) localStorage.setItem("bestScore",score)

    let data=JSON.parse(localStorage.getItem("leaderboard")||"[]")
    data.push({name:player,score})
    data.sort((a,b)=>b.score-a.score)
    localStorage.setItem("leaderboard",JSON.stringify(data.slice(0,10)))

    updateBest()
    setTimeout(()=>switchScreen(home),1500)
}
</script>

</body>
</html>
